{"version":3,"file":"index.js","sources":["../src/clipboard-serializer.ts","../src/index.ts"],"sourcesContent":["import { Slice } from '@tiptap/pm/model';\nimport { EditorView } from '@tiptap/pm/view';\nimport * as pmView from '@tiptap/pm/view';\n\nfunction getPmView() {\n  try {\n      return pmView;\n  } catch (error) {\n      return null;\n  }\n}\n\n\nexport function serializeForClipboard(view: EditorView, slice: Slice) {\n  // Newer Tiptap/ProseMirror\n  // @ts-ignore\n  if (view && typeof view.serializeForClipboard === 'function') {\n    return view.serializeForClipboard(slice);\n  }\n\n  // Older version fallback\n  const proseMirrorView = getPmView();\n  // @ts-ignore\n  if (proseMirrorView && typeof proseMirrorView?.__serializeForClipboard === 'function') {\n    // @ts-ignore\n    return proseMirrorView.__serializeForClipboard(view, slice);\n  }\n\n  throw new Error('No supported clipboard serialization method found.');\n}\n","import { Extension } from '@tiptap/core';\nimport {\n  NodeSelection,\n  Plugin,\n  PluginKey,\n  TextSelection,\n} from '@tiptap/pm/state';\nimport { Fragment, Slice, Node } from '@tiptap/pm/model';\nimport { EditorView } from '@tiptap/pm/view';\nimport { serializeForClipboard } from './clipboard-serializer';\n\nexport interface GlobalDragHandleOptions {\n  /**\n   * The width of the drag handle\n   */\n  dragHandleWidth: number;\n\n  /**\n   * The treshold for scrolling\n   */\n  scrollTreshold: number;\n\n  /*\n   * The css selector to query for the drag handle. (eg: '.custom-handle').\n   * If handle element is found, that element will be used as drag handle. If not, a default handle will be created\n   */\n  dragHandleSelector?: string;\n\n  /**\n   * Tags to be excluded for drag handle\n   */\n  excludedTags: string[];\n\n  /**\n   * Custom nodes to be included for drag handle\n   */\n  customNodes: string[];\n}\nfunction absoluteRect(node: Element) {\n  const data = node.getBoundingClientRect();\n  const modal = node.closest('[role=\"dialog\"]');\n\n  if (modal && window.getComputedStyle(modal).transform !== 'none') {\n    const modalRect = modal.getBoundingClientRect();\n\n    return {\n      top: data.top - modalRect.top,\n      left: data.left - modalRect.left,\n      width: data.width,\n    };\n  }\n  return {\n    top: data.top,\n    left: data.left,\n    width: data.width,\n  };\n}\n\nfunction nodeDOMAtCoords(\n  coords: { x: number; y: number },\n  options: GlobalDragHandleOptions,\n) {\n  const selectors = [\n    'li',\n    'p:not(:first-child)',\n    'pre',\n    'blockquote',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    ...options.customNodes.map((node) => `[data-type=${node}]`),\n  ].join(', ');\n  return document\n    .elementsFromPoint(coords.x, coords.y)\n    .find(\n      (elem: Element) =>\n        elem.parentElement?.matches?.('.ProseMirror') ||\n        elem.matches(selectors),\n    );\n}\nfunction nodePosAtDOM(\n  node: Element,\n  view: EditorView,\n  options: GlobalDragHandleOptions,\n) {\n  const boundingRect = node.getBoundingClientRect();\n\n  return view.posAtCoords({\n    left: boundingRect.left + 50 + options.dragHandleWidth,\n    top: boundingRect.top + 1,\n  })?.inside;\n}\n\nfunction calcNodePos(pos: number, view: EditorView) {\n  const $pos = view.state.doc.resolve(pos);\n  if ($pos.depth > 1) return $pos.before($pos.depth);\n  return pos;\n}\n\nexport function DragHandlePlugin(\n  options: GlobalDragHandleOptions & { pluginKey: string },\n) {\n  let listType = '';\n  function handleDragStart(event: DragEvent, view: EditorView) {\n    view.focus();\n\n    if (!event.dataTransfer) return;\n\n    const node = nodeDOMAtCoords(\n      {\n        x: event.clientX + 50 + options.dragHandleWidth,\n        y: event.clientY,\n      },\n      options,\n    );\n\n    if (!(node instanceof Element)) return;\n\n    let draggedNodePos = nodePosAtDOM(node, view, options);\n    if (draggedNodePos == null || draggedNodePos < 0) return;\n    draggedNodePos = calcNodePos(draggedNodePos, view);\n\n    const { from, to } = view.state.selection;\n    const diff = from - to;\n\n    const fromSelectionPos = calcNodePos(from, view);\n    let differentNodeSelected = false;\n\n    const nodePos = view.state.doc.resolve(fromSelectionPos);\n\n    // Check if nodePos points to the top level node\n    if (nodePos.node().type.name === 'doc') differentNodeSelected = true;\n    else {\n      const nodeSelection = NodeSelection.create(\n        view.state.doc,\n        nodePos.before(),\n      );\n\n      // Check if the node where the drag event started is part of the current selection\n      differentNodeSelected = !(\n        draggedNodePos + 1 >= nodeSelection.$from.pos &&\n        draggedNodePos <= nodeSelection.$to.pos\n      );\n    }\n    let selection = view.state.selection;\n    if (\n      !differentNodeSelected &&\n      diff !== 0 &&\n      !(view.state.selection instanceof NodeSelection)\n    ) {\n      const endSelection = NodeSelection.create(view.state.doc, to - 1);\n      selection = TextSelection.create(\n        view.state.doc,\n        draggedNodePos,\n        endSelection.$to.pos,\n      );\n    } else {\n      selection = NodeSelection.create(view.state.doc, draggedNodePos);\n\n      // if inline node is selected, e.g mention -> go to the parent node to select the whole node\n      // if table row is selected, go to the parent node to select the whole node\n      if (\n        (selection as NodeSelection).node.type.isInline ||\n        (selection as NodeSelection).node.type.name === 'tableRow'\n      ) {\n        let $pos = view.state.doc.resolve(selection.from);\n        selection = NodeSelection.create(view.state.doc, $pos.before());\n      }\n    }\n    view.dispatch(view.state.tr.setSelection(selection));\n\n    // If the selected node is a list item, we need to save the type of the wrapping list e.g. OL or UL\n    if (\n      view.state.selection instanceof NodeSelection &&\n      view.state.selection.node.type.name === 'listItem'\n    ) {\n      listType = node.parentElement!.tagName;\n    }\n\n    const slice = view.state.selection.content();\n    const { dom, text } = serializeForClipboard(view, slice);\n\n    event.dataTransfer.clearData();\n    event.dataTransfer.setData('text/html', dom.innerHTML);\n    event.dataTransfer.setData('text/plain', text);\n    event.dataTransfer.effectAllowed = 'copyMove';\n\n    event.dataTransfer.setDragImage(node, 0, 0);\n\n    view.dragging = { slice, move: event.ctrlKey };\n  }\n\n  let dragHandleElement: HTMLElement | null = null;\n\n  function hideDragHandle() {\n    if (dragHandleElement) {\n      dragHandleElement.classList.add('hide');\n    }\n  }\n\n  function showDragHandle() {\n    if (dragHandleElement) {\n      dragHandleElement.classList.remove('hide');\n    }\n  }\n\n  function hideHandleOnEditorOut(event: MouseEvent) {\n    if (event.target instanceof Element) {\n      // Check if the relatedTarget class is still inside the editor\n      const relatedTarget = event.relatedTarget as HTMLElement;\n      const isInsideEditor =\n        relatedTarget?.classList.contains('tiptap') ||\n        relatedTarget?.classList.contains('drag-handle');\n\n      if (isInsideEditor) return;\n    }\n    hideDragHandle();\n  }\n\n  return new Plugin({\n    key: new PluginKey(options.pluginKey),\n    view: (view) => {\n      const handleBySelector = options.dragHandleSelector\n        ? document.querySelector<HTMLElement>(options.dragHandleSelector)\n        : null;\n      dragHandleElement = handleBySelector ?? document.createElement('div');\n      dragHandleElement.draggable = true;\n      dragHandleElement.dataset.dragHandle = '';\n      dragHandleElement.classList.add('drag-handle');\n\n      function onDragHandleDragStart(e: DragEvent) {\n        handleDragStart(e, view);\n      }\n\n      dragHandleElement.addEventListener('dragstart', onDragHandleDragStart);\n\n      function onDragHandleDrag(e: DragEvent) {\n        hideDragHandle();\n        let scrollY = window.scrollY;\n        if (e.clientY < options.scrollTreshold) {\n          window.scrollTo({ top: scrollY - 30, behavior: 'smooth' });\n        } else if (window.innerHeight - e.clientY < options.scrollTreshold) {\n          window.scrollTo({ top: scrollY + 30, behavior: 'smooth' });\n        }\n      }\n\n      dragHandleElement.addEventListener('drag', onDragHandleDrag);\n\n      hideDragHandle();\n\n      if (!handleBySelector) {\n        view?.dom?.parentElement?.appendChild(dragHandleElement);\n      }\n      // Attach the event listener to view.dom directly\n      const editorElement = view.dom;\n      \n      // Define the event handler function so it can be referenced for removal\n      const mouseOutEventHandler = (event: MouseEvent) => {\n        hideHandleOnEditorOut(event);\n      };\n\n      if (editorElement) {\n        editorElement.addEventListener(\n          'mouseout',\n          mouseOutEventHandler\n        );\n      }\n\n      return {\n        destroy: () => {\n          if (!handleBySelector) {\n            dragHandleElement?.remove?.();\n          }\n          dragHandleElement?.removeEventListener('drag', onDragHandleDrag);\n          dragHandleElement?.removeEventListener(\n            'dragstart',\n            onDragHandleDragStart,\n          );\n          dragHandleElement = null;\n          if (editorElement) {\n            editorElement.removeEventListener(\n              'mouseout',\n              mouseOutEventHandler, // Use the stored handler function\n            );\n          }\n        },\n      };\n    },\n    props: {\n      handleDOMEvents: {\n        mousemove: (view, event) => {\n          if (!view.editable) {\n            return;\n          }\n\n          const node = nodeDOMAtCoords(\n            {\n              x: event.clientX + 50 + options.dragHandleWidth,\n              y: event.clientY,\n            },\n            options,\n          );\n\n          const notDragging = node?.closest('.not-draggable');\n          const excludedTagList = options.excludedTags\n            .concat(['ol', 'ul'])\n            .join(', ');\n\n          if (\n            !(node instanceof Element) ||\n            node.matches(excludedTagList) ||\n            notDragging\n          ) {\n            hideDragHandle();\n            return;\n          }\n\n          const compStyle = window.getComputedStyle(node);\n          const parsedLineHeight = parseInt(compStyle.lineHeight, 10);\n          const lineHeight = isNaN(parsedLineHeight)\n            ? parseInt(compStyle.fontSize) * 1.2\n            : parsedLineHeight;\n          const paddingTop = parseInt(compStyle.paddingTop, 10);\n\n          const rect = absoluteRect(node);\n\n          rect.top += (lineHeight - 24) / 2;\n          rect.top += paddingTop;\n          // Li markers\n          if (node.matches('ul:not([data-type=taskList]) li, ol li')) {\n            rect.left -= options.dragHandleWidth;\n          }\n          rect.width = options.dragHandleWidth;\n\n          if (!dragHandleElement) return;\n\n          dragHandleElement.style.left = `${rect.left - rect.width}px`;\n          dragHandleElement.style.top = `${rect.top}px`;\n          showDragHandle();\n        },\n        keydown: () => {\n          hideDragHandle();\n        },\n        mousewheel: () => {\n          hideDragHandle();\n        },\n        // dragging class is used for CSS\n        dragstart: (view) => {\n          view.dom.classList.add('dragging');\n        },\n        drop: (view, event) => {\n          view.dom.classList.remove('dragging');\n          hideDragHandle();\n          let droppedNode: Node | null = null;\n          const dropPos = view.posAtCoords({\n            left: event.clientX,\n            top: event.clientY,\n          });\n\n          if (!dropPos) return;\n\n          if (view.state.selection instanceof NodeSelection) {\n            droppedNode = view.state.selection.node;\n          }\n          if (!droppedNode) return;\n\n          const resolvedPos = view.state.doc.resolve(dropPos.pos);\n\n          const isDroppedInsideList =\n            resolvedPos.parent.type.name === 'listItem';\n\n          // If the selected node is a list item and is not dropped inside a list, we need to wrap it inside <ol> tag otherwise ol list items will be transformed into ul list item when dropped\n          if (\n            view.state.selection instanceof NodeSelection &&\n            view.state.selection.node.type.name === 'listItem' &&\n            !isDroppedInsideList &&\n            listType == 'OL'\n          ) {\n            const newList = view.state.schema.nodes.orderedList?.createAndFill(\n              null,\n              droppedNode,\n            );\n            const slice = new Slice(Fragment.from(newList), 0, 0);\n            view.dragging = { slice, move: event.ctrlKey };\n          }\n        },\n        dragend: (view) => {\n          view.dom.classList.remove('dragging');\n        },\n      },\n    },\n  });\n}\n\nconst GlobalDragHandle = Extension.create({\n  name: 'globalDragHandle',\n\n  addOptions() {\n    return {\n      dragHandleWidth: 20,\n      scrollTreshold: 100,\n      excludedTags: [],\n      customNodes: [],\n    };\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      DragHandlePlugin({\n        pluginKey: 'globalDragHandle',\n        dragHandleWidth: this.options.dragHandleWidth,\n        scrollTreshold: this.options.scrollTreshold,\n        dragHandleSelector: this.options.dragHandleSelector,\n        excludedTags: this.options.excludedTags,\n        customNodes: this.options.customNodes,\n      }),\n    ];\n  },\n});\n\nexport default GlobalDragHandle;\n"],"names":[],"mappings":"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"}